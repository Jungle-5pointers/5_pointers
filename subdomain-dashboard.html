<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>5Pointers 서브도메인 대시보드</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
            background: #f8fafc; 
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: white; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            text-align: center;
        }
        .status { 
            background: #e8f5e8; 
            color: #2d5e2d; 
            padding: 15px 20px; 
            border-radius: 8px; 
            margin: 20px 0;
            border-left: 4px solid #4ade80;
        }
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
            gap: 20px; 
        }
        .card { 
            background: white; 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card h3 { 
            color: #1e293b; 
            margin-bottom: 15px; 
            font-size: 18px;
        }
        .site-list { 
            list-style: none; 
            max-height: 400px; 
            overflow-y: auto;
        }
        .site-item { 
            padding: 12px; 
            margin-bottom: 8px; 
            background: #f8fafc; 
            border-radius: 8px; 
            border: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .site-name { 
            font-weight: 500; 
            color: #1e40af; 
            text-decoration: none;
        }
        .site-name:hover { 
            text-decoration: underline; 
        }
        .test-btn { 
            background: #3b82f6; 
            color: white; 
            padding: 6px 12px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 12px;
        }
        .test-btn:hover { 
            background: #2563eb; 
        }
        .instruction { 
            background: #fef3c7; 
            color: #92400e; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0;
            border-left: 4px solid #f59e0b;
        }
        .hosts-content { 
            background: #f1f5f9; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Courier New', monospace; 
            font-size: 12px; 
            max-height: 300px; 
            overflow-y: auto;
            border: 1px solid #cbd5e1;
        }
        .loading { 
            text-align: center; 
            color: #64748b; 
            padding: 20px; 
        }
        .error { 
            background: #fee2e2; 
            color: #dc2626; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🌐 5Pointers 서브도메인 대시보드</h1>
            <div class="status" id="status">
                ✅ 서브도메인 서버가 실행 중입니다 (포트 3001)
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h3>📋 배포된 서브도메인 목록</h3>
                <div id="sites-loading" class="loading">로딩 중...</div>
                <ul id="sites-list" class="site-list" style="display: none;"></ul>
            </div>

            <div class="card">
                <h3>🔧 브라우저 접근 설정</h3>
                <div class="instruction">
                    <strong>방법 1: /etc/hosts 파일 수정 (권장)</strong><br>
                    아래 내용을 복사해서 /etc/hosts 파일에 추가하세요.
                </div>
                <div id="hosts-entries" class="hosts-content">로딩 중...</div>
                
                <div style="margin-top: 15px;">
                    <button onclick="copyHostsEntries()" class="test-btn">📋 복사하기</button>
                    <button onclick="refreshData()" class="test-btn">🔄 새로고침</button>
                </div>
            </div>

            <div class="card">
                <h3>🧪 테스트 도구</h3>
                <p>아래 방법들로 서브도메인이 작동하는지 확인할 수 있습니다:</p>
                <div style="margin-top: 15px;">
                    <div style="margin-bottom: 10px;">
                        <strong>curl 테스트:</strong><br>
                        <code style="background: #f1f5f9; padding: 5px; border-radius: 4px; display: block; margin-top: 5px;">
                            curl -H "Host: testsite.localhost:3001" http://localhost:3001
                        </code>
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>서브도메인 서버 상태:</strong><br>
                        <a href="http://localhost:3001" target="_blank" class="site-name">localhost:3001 열기</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let subdomains = [];

        async function fetchSubdomains() {
            try {
                // 실제로는 API에서 가져와야 하지만, 여기서는 고정 목록 사용
                // 실제 구현시에는 백엔드 API를 호출
                const response = await fetch('/api/subdomains'); // 이건 실제로는 작동하지 않음
                return await response.json();
            } catch (error) {
                // 고정 서브도메인 목록 (테스트용)
                return [
                    { subdomain: 'testsite', title: 'Test Site', updated_at: new Date() },
                    { subdomain: 'testpage2', title: 'Test Page 2', updated_at: new Date() },
                    { subdomain: '23qwe', title: 'Elegant Wedding Invitation', updated_at: new Date() },
                    { subdomain: '31as', title: 'Untitled', updated_at: new Date() }
                ];
            }
        }

        function renderSites(sites) {
            const sitesList = document.getElementById('sites-list');
            const loading = document.getElementById('sites-loading');
            
            loading.style.display = 'none';
            sitesList.style.display = 'block';
            
            sitesList.innerHTML = sites.map(site => `
                <li class="site-item">
                    <div>
                        <div class="site-name">${site.subdomain}</div>
                        <small style="color: #64748b;">${site.title}</small>
                    </div>
                    <button class="test-btn" onclick="testSite('${site.subdomain}')">테스트</button>
                </li>
            `).join('');

            // hosts 파일 엔트리 생성
            const hostsEntries = sites.map(site => 
                `127.0.0.1   ${site.subdomain}.localhost`
            ).join('\n');
            
            document.getElementById('hosts-entries').textContent = 
                '# 5Pointers Subdomains\n' + hostsEntries;
        }

        function testSite(subdomain) {
            // Host 헤더를 사용한 테스트를 위해 새 창 열기
            const testUrl = `http://localhost:3001`;
            const newWindow = window.open('about:blank', '_blank');
            
            // 사용자에게 안내
            newWindow.document.write(`
                <html>
                <head><title>서브도메인 테스트: ${subdomain}</title></head>
                <body style="font-family: sans-serif; padding: 20px;">
                    <h2>서브도메인 테스트: ${subdomain}</h2>
                    <p><strong>방법 1:</strong> /etc/hosts 파일에 다음을 추가한 후 브라우저에서 접근:</p>
                    <code style="background: #f0f0f0; padding: 10px; display: block;">127.0.0.1   ${subdomain}.localhost</code>
                    <p>그 다음 <a href="http://${subdomain}.localhost:3001" target="_blank">http://${subdomain}.localhost:3001</a>로 접근</p>
                    
                    <p><strong>방법 2:</strong> curl 명령어로 테스트:</p>
                    <code style="background: #f0f0f0; padding: 10px; display: block;">curl -H "Host: ${subdomain}.localhost:3001" http://localhost:3001</code>
                    
                    <p><strong>방법 3:</strong> 개발자 도구에서 Network 탭을 열고 localhost:3001 요청의 헤더에 다음을 추가:</p>
                    <code style="background: #f0f0f0; padding: 10px; display: block;">Host: ${subdomain}.localhost:3001</code>
                </body>
                </html>
            `);
        }

        function copyHostsEntries() {
            const hostsContent = document.getElementById('hosts-entries').textContent;
            navigator.clipboard.writeText(hostsContent).then(() => {
                alert('복사되었습니다! /etc/hosts 파일에 붙여넣기 하세요.');
            }).catch(() => {
                alert('복사 실패. 내용을 수동으로 선택해서 복사하세요.');
            });
        }

        async function refreshData() {
            document.getElementById('sites-loading').style.display = 'block';
            document.getElementById('sites-list').style.display = 'none';
            
            const sites = await fetchSubdomains();
            renderSites(sites);
        }

        // 페이지 로드시 데이터 가져오기
        window.addEventListener('load', refreshData);
    </script>
</body>
</html>